<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Solo Leveling Quest Tracker</title>
  <style>
    body { font-family: system-ui,sans-serif; background: #0f172a; color: #e5e7eb; margin:0; padding:16px; }
    h1 { text-align:center; margin-bottom:16px; }
    .card { background:#111827; border-radius:16px; padding:16px; margin-bottom:16px; box-shadow:0 10px 25px rgba(0,0,0,0.4);}
    input, select, button { width:100%; padding:12px; border-radius:12px; border:none; margin-top:8px; font-size:16px;}
    input { background:#020617; color:white; }
    button { background:#2563eb; color:white; font-weight:bold; }
    button.danger { background:#dc2626; }
    .progress { font-size:16px; margin-top:12px; white-space:pre-line; }
  </style>
</head>
<body>

  <h1>üó°Ô∏è Solo Leveling Quest Tracker</h1>

  <!-- Nieuwe Quest Toevoegen -->
  <div class="card">
    <h2>Nieuwe Quest toevoegen</h2>
    <input id="questName" type="text" placeholder="Naam van het doel">
    <select id="questType">
      <option value="daily">Daily</option>
      <option value="timed">Timed (deadline)</option>
    </select>
    <input id="questGoal" type="number" placeholder="Doel (bijv. 100)" max="1000000">
    <input id="rewardStrength" type="number" placeholder="Reward Strength">
    <input id="rewardIntelligence" type="number" placeholder="Reward Intelligence">
    <input id="rewardAgility" type="number" placeholder="Reward Agility">
    <input id="penaltyStrength" type="number" placeholder="Penalty Strength">
    <input id="penaltyIntelligence" type="number" placeholder="Penalty Intelligence">
    <input id="penaltyAgility" type="number" placeholder="Penalty Agility">
    <input id="questDeadline" type="date" placeholder="Deadline (alleen voor timed)">
    <button onclick="addQuest()">Voeg quest toe</button>
  </div>

  <!-- Progressie Toevoegen -->
  <div class="card">
    <h2>Progressie toevoegen</h2>
    <select id="progressQuest"></select>
    <input id="progressAmount" type="number" placeholder="Aantal gedaan (1-1000000)" max="1000000">
    <button onclick="addProgress()">Voeg progressie toe</button>
  </div>

  <!-- Stats en Voortgang -->
  <div class="card">
    <h2>Voortgang en Stats</h2>
    <div class="progress" id="progressDisplay"></div>
    <div class="progress" id="statsDisplay"></div>
    <button class="danger" onclick="resetDaily()">Reset dagelijkse quests</button>
  </div>

  <!-- Quest Bewerken / Verwijderen -->
  <div class="card">
    <h2>Quest bewerken / verwijderen</h2>
    <select id="editQuest"></select>
    <button onclick="editQuest()">Bewerk quest</button>
    <button class="danger" onclick="deleteQuest()">Verwijder quest</button>
  </div>

  <script>
    // ==================== Initialisatie ====================
    let stats = JSON.parse(localStorage.getItem('stats')) || {strength:0,intelligence:0,agility:0};
    let quests = JSON.parse(localStorage.getItem('quests')) || [];

    function saveStats(){ localStorage.setItem('stats', JSON.stringify(stats)); }
    function saveQuests(){ localStorage.setItem('quests', JSON.stringify(quests)); }

    // ==================== Quest Toevoegen ====================
    function addQuest(){
      const name=document.getElementById('questName').value.trim();
      const type=document.getElementById('questType').value;
      const goal=Number(document.getElementById('questGoal').value);
      const rewardStats={
        strength:Number(document.getElementById('rewardStrength').value)||0,
        intelligence:Number(document.getElementById('rewardIntelligence').value)||0,
        agility:Number(document.getElementById('rewardAgility').value)||0
      };
      const penaltyStats={
        strength:Number(document.getElementById('penaltyStrength').value)||0,
        intelligence:Number(document.getElementById('penaltyIntelligence').value)||0,
        agility:Number(document.getElementById('penaltyAgility').value)||0
      };
      let deadline=document.getElementById('questDeadline').value;
      if(type==='daily') deadline=null;
      if(!name||!goal) return alert('Vul naam en doel in!');

      quests.push({name,type,goal,done:0,rewardStats,penaltyStats,lastCompleted:null,deadline});
      saveQuests();
      updateQuestDropdown();
      updateEditDropdown();
      updateDisplay();

      // Clear inputs
      document.getElementById('questName').value='';
      document.getElementById('questGoal').value='';
      document.getElementById('rewardStrength').value='';
      document.getElementById('rewardIntelligence').value='';
      document.getElementById('rewardAgility').value='';
      document.getElementById('penaltyStrength').value='';
      document.getElementById('penaltyIntelligence').value='';
      document.getElementById('penaltyAgility').value='';
      document.getElementById('questDeadline').value='';
    }

    // ==================== Dropdowns ====================
    function updateQuestDropdown(){
      const select=document.getElementById('progressQuest');
      select.innerHTML='';
      quests.forEach(q=>{
        const option=document.createElement('option');
        option.value=q.name;
        option.textContent=`${q.name} (${q.type})`;
        select.appendChild(option);
      });
    }

    function updateEditDropdown(){
      const select=document.getElementById('editQuest');
      select.innerHTML='';
      quests.forEach(q=>{
        const option=document.createElement('option');
        option.value=q.name;
        option.textContent=`${q.name} (${q.type})`;
        select.appendChild(option);
      });
    }

    // ==================== Progressie ====================
    function addProgress(){
      const questName=document.getElementById('progressQuest').value;
      let amount=Number(document.getElementById('progressAmount').value);
      if(isNaN(amount)||amount<1) return alert('Voer een getal in tussen 1 en 1.000.000');
      if(amount>1000000) amount=1000000;
      const quest=quests.find(q=>q.name===questName);
      if(!quest) return alert('Quest niet gevonden');

      quest.done+=amount;
      if(quest.done>=quest.goal) completeQuest(quest);
      saveQuests();
      updateDisplay();
      document.getElementById('progressAmount').value='';
    }

    // ==================== Quest Voltooid ====================
    function completeQuest(quest){
      for(const stat in quest.rewardStats) stats[stat]+=quest.rewardStats[stat];

      if(quest.type==='daily'){
        quest.lastCompleted=new Date().toDateString();
        quest.done=quest.goal;
        alert(`‚úÖ Daily quest voltooid! Stats +: ${JSON.stringify(quest.rewardStats)}`);
      } else {
        alert(`‚úÖ Quest voltooid! Stats +: ${JSON.stringify(quest.rewardStats)}`);
        quests=quests.filter(q=>q.name!==quest.name);
      }
      saveStats();
      saveQuests();
      updateQuestDropdown();
      updateEditDropdown();
    }

    // ==================== Quest Falen ====================
    function failQuest(quest){
      for(const stat in quest.penaltyStats){
        stats[stat]+=quest.penaltyStats[stat];
        if(stats[stat]<0) stats[stat]=0;
      }
      quest.done=0;
      if(quest.type==='daily') quest.lastCompleted=null;
      alert(`‚ùå Quest gefaald! Stats -: ${JSON.stringify(quest.penaltyStats)}`);
      saveStats();
      saveQuests();
      updateDisplay();
    }

    // ==================== Display ====================
    function updateDisplay(){
      const display=document.getElementById('progressDisplay');
      const statsDisp=document.getElementById('statsDisplay');
      const today=new Date().toDateString();
      let text='';
      quests.forEach(q=>{
        if(q.type==='daily'){
          if(!q.lastCompleted) q.done=0;
          text+=`${q.name} (Daily): ${q.done}/${q.goal}\nReward: ${JSON.stringify(q.rewardStats)} | Penalty: ${JSON.stringify(q.penaltyStats)}\nVoltooid: ${q.lastCompleted===today?'‚úÖ':'‚ùå'}\n\n`;
        } else {
          let daysLeft=Math.max(0, Math.ceil((new Date(q.deadline)-new Date())/(1000*60*60*24)));
          text+=`${q.name} (Timed, ${daysLeft} dagen over): ${q.done}/${q.goal}\nReward: ${JSON.stringify(q.rewardStats)} | Penalty: ${JSON.stringify(q.penaltyStats)}\n\n`;
        }
      });
      display.textContent=text;

      statsDisp.textContent=`Stats:\nStrength: ${stats.strength} (Level ${Math.floor(stats.strength/5)})\nIntelligence: ${stats.intelligence} (Level ${Math.floor(stats.intelligence/5)})\nAgility: ${stats.agility} (Level ${Math.floor(stats.agility/5)})`;
    }

    // ==================== Daily Reset ====================
    function resetDaily(){
      if(confirm('Weet je zeker dat je alle dagelijkse progressie wilt resetten?')){
        const today=new Date().toDateString();
        quests.forEach(q=>{
          if(q.type==='daily'){
            if(q.done<q.goal) failQuest(q);
            q.done=0;
            q.lastCompleted=null;
          }
        });
        saveQuests();
        updateDisplay();
      }
    }

    // ==================== Quest Bewerken ====================
    function editQuest(){
      const questName=document.getElementById('editQuest').value;
      const quest=quests.find(q=>q.name===questName);
      if(!quest) return alert('Quest niet gevonden');

      const newGoal=prompt("Nieuw doel:",quest.goal)||quest.goal;
      const newRewardStrength=prompt("Reward Strength:",quest.rewardStats.strength)||quest.rewardStats.strength;
      const newRewardIntelligence=prompt("Reward Intelligence:",quest.rewardStats.intelligence)||quest.rewardStats.intelligence;
      const newRewardAgility=prompt("Reward Agility:",quest.rewardStats.agility)||quest.rewardStats.agility;
      const newPenaltyStrength=prompt("Penalty Strength:",quest.penaltyStats.strength)||quest.penaltyStats.strength;
      const newPenaltyIntelligence=prompt("Penalty Intelligence:",quest.penaltyStats.intelligence)||quest.penaltyStats.intelligence;
      const newPenaltyAgility=prompt("Penalty Agility:",quest.penaltyStats.agility)||quest.penaltyStats.agility;

      quest.goal=Number(newGoal);
      quest.rewardStats.strength=Number(newRewardStrength);
      quest.rewardStats.intelligence=Number(newRewardIntelligence);
      quest.rewardStats.agility=Number(newRewardAgility);
      quest.penaltyStats.strength=Number(newPenaltyStrength);
      quest.penaltyStats.intelligence=Number(newPenaltyIntelligence);
      quest.penaltyStats.agility=Number(newPenaltyAgility);

      if(quest.type==='timed'){
        const newDeadline=prompt("Deadline (yyyy-mm-dd):",quest.deadline)||quest.deadline;
        quest.deadline=newDeadline;
      }

      saveQuests();
      updateQuestDropdown();
      updateEditDropdown();
      updateDisplay();
      alert(`Quest "${quest.name}" is bijgewerkt.`);
    }

    // ==================== Quest Verwijderen ====================
    function deleteQuest(){
      const questName=document.getElementById('editQuest').value;
      quests=quests.filter(q=>q.name!==questName);
      saveQuests();
      updateQuestDropdown();
      updateEditDropdown();
      updateDisplay();
      alert(`Quest "${questName}" is verwijderd.`);
    }

    // ==================== Notifications ====================
    if('Notification' in window){
      Notification.requestPermission().then(permission=>{
        if(permission==='granted') console.log('Notifications allowed ‚úÖ');
      });
    }

    function sendReminder(quest){
      if('Notification' in window && Notification.permission==='granted'){
        new Notification(`Herinnering: ${quest.name} nog niet voltooid!`,{
          body:`Doel: ${quest.goal} | Reward: ${JSON.stringify(quest.rewardStats)} | Penalty: ${JSON.stringify(quest.penaltyStats)}`,
          icon:'icon-192.png'
        });
      }
    }

    function checkReminders(){
      const today=new Date().toDateString();
      quests.forEach(q=>{
        if(q.type==='daily' && q.done<q.goal && (!q.lastReminder||q.lastReminder!==today)){
          sendReminder(q);
          q.lastReminder=today;
        }
      });
      saveQuests();
    }
    setInterval(checkReminders,15*60*1000); // elke 15 minuten

    // ==================== Start ====================
    updateQuestDropdown();
    updateEditDropdown();
    updateDisplay();
  </script>
</body>
</html>
